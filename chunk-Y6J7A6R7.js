import{c as D,f as P,h as x,i as G,l as R,n as q,o as f,p as O,q as $,r as F,s as M,t as j,u as A,v as V,w as C,x as k}from"./chunk-N6YNGZBS.js";import{Ha as i,Qa as N,W as L,Wa as g,aa as p,ab as T,c as S,eb as c,fb as l,gb as r,hb as b,jb as B,kb as y,q as E,rb as a,sb as s,vb as m,wb as d}from"./chunk-RHSHQOGT.js";var U="https://cromix-backend.onrender.com";var w=U,I={GET:`${w}/users`,GET_BY_ID:e=>`${w}/users/${e}`,CREATE:`${w}/users`,LOGIN:`${w}/users/login`,DELETE:e=>`${w}/users/${e}`};var H=(()=>{class e{constructor(){this.http=p(D),this.growlService=p(C),this.authService=p(k),this.router=p(x)}signup(n){return S(this,null,function*(){try{let t=yield E(this.http.post(I.CREATE,n));this.growlService.setMessage("login.success","success"),this.router.navigate(["/home"]).then()}catch(t){this.growlService.setMessage(`common.errors.${t.error.error}`,"danger")}})}login(n){return S(this,null,function*(){try{let t=yield E(this.http.post(I.LOGIN,n));localStorage.setItem("user",JSON.stringify(t)),this.authService.setUser(t),this.router.navigate(["/home"]).then()}catch(t){this.growlService.setMessage(`common.errors.${t.error.code}`,"danger")}})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=L({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Y(e,u){e&1&&(l(0,"div",8),a(1),m(2,"translate"),r()),e&2&&(i(),s(d(2,1,"login.errors.field-required")))}function z(e,u){e&1&&(l(0,"div",8),a(1),m(2,"translate"),r()),e&2&&(i(),s(d(2,1,"login.errors.username-invalid")))}function K(e,u){if(e&1&&g(0,Y,3,3,"div",8)(1,z,3,3,"div",8),e&2){let n,t,o=y();c(!((n=o.form.get("username"))==null||n.errors==null)&&n.errors.required?0:-1),i(),c(!((t=o.form.get("username"))==null||t.errors==null)&&t.errors.email?1:-1)}}function Q(e,u){e&1&&(l(0,"div",8),a(1),m(2,"translate"),r()),e&2&&(i(),s(d(2,1,"login.errors.field-required")))}function W(e,u){e&1&&(l(0,"div",8),a(1),m(2,"translate"),r()),e&2&&(i(),s(d(2,1,"login.errors.password-length")))}function X(e,u){e&1&&(l(0,"div",8),a(1),m(2,"translate"),r()),e&2&&(i(),s(d(2,1,"login.errors.field-required")))}function Z(e,u){e&1&&(l(0,"div",8),a(1),m(2,"translate"),r()),e&2&&(i(),s(d(2,1,"login.errors.password-length")))}function ee(e,u){if(e&1&&(l(0,"div",3)(1,"label",12),a(2),m(3,"translate"),r(),b(4,"input",13),g(5,X,3,3,"div",8)(6,Z,3,3,"div",8),r()),e&2){let n,t,o=y();i(2),s(d(3,3,"login.password-confirm")),i(3),c((n=o.form.get("confirmPassword"))!=null&&n.touched&&(!((n=o.form.get("confirmPassword"))==null||n.errors==null)&&n.errors.required)?5:-1),i(),c((t=o.form.get("confirmPassword"))!=null&&t.touched&&(!((t=o.form.get("confirmPassword"))==null||t.errors==null)&&t.errors.minlength)?6:-1)}}var we=(()=>{class e{constructor(){this.title="",this.btnSubmitText="",this.mode="login",this.route=p(P),this.fb=p(A),this.service=p(H),this.growlService=p(C),this.router=p(x),this.title=this.route.snapshot.title||"",this.title==="login.title"?this.mode="login":this.mode="register",this.form=this.fb.group({username:["",[f.required,f.email]],password:["",[f.required,f.minLength(8)]]}),this.mode==="login"?this.btnSubmitText="common.buttons.login":(this.btnSubmitText="common.buttons.register",this.form.addControl("confirmPassword",this.fb.control("",[f.required,f.minLength(8)])))}onSubmit(){return S(this,null,function*(){if(!this.form.valid)return;let n=this.form.value;if(this.mode==="login")yield this.service.login(n);else if(this.mode==="register"){if(n.password!==n.confirmPassword){this.growlService.setMessage("login.errors.pasword-match","danger");return}yield this.service.signup(n)}})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=N({type:e,selectors:[["app-login"]],decls:27,vars:21,consts:[[1,"row","my-3"],[1,"row"],[1,"col-md-6","offset-md-3",3,"ngSubmit","formGroup"],[1,"my-3"],["for","username",1,"form-label"],["type","text","id","username","formControlName","username",1,"form-control"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password",1,"form-control"],[1,"text-danger"],[1,"d-flex","justify-content-center","gap-4","my-5"],["type","button","routerLink","",1,"btn","btn-primary"],["type","submit",1,"btn","btn-secondary",3,"disabled"],["for","confirm-password",1,"form-label"],["type","password","id","confirm-password","formControlName","confirmPassword",1,"form-control"]],template:function(t,o){if(t&1&&(l(0,"div",0)(1,"h1"),a(2),m(3,"translate"),r()(),l(4,"div",1)(5,"form",2),B("ngSubmit",function(){return o.onSubmit()}),l(6,"div",3)(7,"label",4),a(8),m(9,"translate"),r(),b(10,"input",5),g(11,K,2,2),r(),l(12,"div",3)(13,"label",6),a(14),m(15,"translate"),r(),b(16,"input",7),g(17,Q,3,3,"div",8)(18,W,3,3,"div",8),r(),g(19,ee,7,5,"div",3),l(20,"div",9)(21,"button",10),a(22),m(23,"translate"),r(),l(24,"button",11),a(25),m(26,"translate"),r()()()()),t&2){let h,v,_;i(2),s(d(3,11,o.title)),i(3),T("formGroup",o.form),i(3),s(d(9,13,"login.username")),i(3),c((h=o.form.get("username"))!=null&&h.touched&&((h=o.form.get("username"))!=null&&h.invalid)?11:-1),i(3),s(d(15,15,"login.password")),i(3),c((v=o.form.get("username"))!=null&&v.touched&&(!((v=o.form.get("password"))==null||v.errors==null)&&v.errors.required)?17:-1),i(),c((_=o.form.get("password"))!=null&&_.touched&&(!((_=o.form.get("password"))==null||_.errors==null)&&_.errors.minlength)?18:-1),i(),c(o.mode==="register"?19:-1),i(3),s(d(23,17,"common.buttons.cancel")),i(2),T("disabled",!o.form.valid),i(),s(d(26,19,o.btnSubmitText))}},dependencies:[R,V,F,q,O,$,M,j,G],encapsulation:2})}}return e})();export{we as LoginComponent};
